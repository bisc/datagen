(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     11482,        265]
NotebookOptionsPosition[     11112,        251]
NotebookOutlinePosition[     11526,        267]
CellTagsIndexPosition[     11483,        264]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{
  "(*", " ", "\"\</Users/alanismaiel/Desktop/datagen-master/StaticEx.txt\>\"",
    " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
  "(*", " ", "\"\</Users/alanismaiel/Desktop/StaticEx2.txt\>\"", " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
  "(*", " ", "\"\</Users/alanismaiel/Desktop/StaticEx3.txt\>\"", " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
  "(*", " ", 
   "\"\</Users/alanismaiel/Desktop/datagen-master/StaticExContradictory.txt\>\
\"", " ", "*)"}], " ", "\[IndentingNewLine]", 
  RowBox[{
  "(*", " ", "\"\</Users/alanismaiel/Desktop/StaticExUnder.txt\>\"", " ", 
   "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Pass", " ", "file", " ", "name", " ", "into", " ", "staticGenerate"}], 
   " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"staticGenerate", "[", "s_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"input", " ", "=", " ", "s"}], ",", "oParams", ",", " ", 
       "oOutput", ",", " ", "oEquations", ",", " ", "oConstraints", ",", " ", 
       "oSolve", ",", " ", "oRules", ",", " ", "oFinalRules", ",", " ", "oD", 
       ",", " ", "underCheck"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Clear", "[", 
       RowBox[{
       "values", ",", " ", "variables", ",", " ", "casetype", ",", " ", 
        "specs"}], "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{"Run", " ", "other", " ", "notebooks", " ", 
        RowBox[{"(", 
         RowBox[{
         "without", " ", "having", " ", "to", " ", "see", " ", "them"}], 
         ")"}], " ", "if", " ", "file", " ", "name", " ", "is", " ", 
        "valid"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FileExistsQ", "[", 
         RowBox[{"StringJoin", "[", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], ",", "input"}], "]"}], 
         "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{"NotebookOpen", "[", 
           RowBox[{
            RowBox[{"StringJoin", "[", 
             RowBox[{
              RowBox[{"NotebookDirectory", "[", "]"}], ",", 
              "\"\<specConversion.nb\>\""}], "]"}], ",", 
            RowBox[{"Visible", "\[Rule]", " ", "False"}]}], "]"}], "]"}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{"NotebookOpen", "[", 
           RowBox[{
            RowBox[{"StringJoin", "[", 
             RowBox[{
              RowBox[{"NotebookDirectory", "[", "]"}], ",", 
              "\"\<oGenerator.nb\>\""}], "]"}], ",", 
            RowBox[{"Visible", "\[Rule]", " ", "False"}]}], "]"}], "]"}], ";",
          "\[IndentingNewLine]", 
         RowBox[{"NotebookEvaluate", "[", 
          RowBox[{"NotebookOpen", "[", 
           RowBox[{
            RowBox[{"StringJoin", "[", 
             RowBox[{
              RowBox[{"NotebookDirectory", "[", "]"}], ",", 
              "\"\<Parsing_input.nb\>\""}], "]"}], ",", 
            RowBox[{"Visible", "\[Rule]", " ", "False"}]}], "]"}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Parsing", " ", "the", " ", "input", " ", "to", " ", "extract", " ", 
        "the", " ", "necessary", " ", "information", " ", "for", " ", "the", 
        " ", "static", " ", "case"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"parse", "[", "input", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Parameterizing", " ", "the", " ", "specifications", " ", "with", " ", 
        "generated", " ", "o", " ", "parameters"}], " ", "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"oParams", " ", "=", " ", 
       RowBox[{"oGen", "[", " ", 
        RowBox[{"variables", ",", " ", "values"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"oOutput", " ", "=", " ", 
       RowBox[{"oOutcomes", "[", "oParams", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"oEquations", "=", " ", 
       RowBox[{
        RowBox[{"specs", " ", "/.", " ", "unconditionedProbability"}], " ", "/.",
         " ", "conditionedProbability"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"oEquations", ",", " ", 
        RowBox[{"givenEquation", "[", "oParams", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Solving", " ", "the", " ", "probability", " ", "system", " ", "based",
         " ", "on", " ", "the", " ", "specifications", " ", "and", " ", 
        "constraints"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"oConstraints", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"#", "\[Element]", 
          RowBox[{"Interval", "[", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1"}], "}"}], "]"}]}], "&"}], "/@", 
        "oOutput"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"oSolve", " ", "=", " ", 
       RowBox[{"TimeConstrained", "[", 
        RowBox[{
         RowBox[{"Solve", "[", 
          RowBox[{
           RowBox[{"Join", "[", 
            RowBox[{"oEquations", ",", "oConstraints"}], "]"}], ",", 
           "oOutput", ",", "Reals"}], "]"}], ",", "60", ",", "$Failed"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FailureQ", "[", "oSolve", "]"}], ",", 
        RowBox[{
        "Print", "[", "\"\<Invalid system: solver timed out\>\"", "]"}]}], 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Generating", " ", "data", " ", "by", " ", "placing", " ", "the", " ", 
        "solution", " ", "into", " ", "a", " ", "categorical", " ", 
        "distribution"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"FailureQ", "[", "oSolve", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"Length", "[", "oSolve", "]"}], " ", "\[NotEqual]", " ", 
            "1"}], " ", "||", " ", 
           RowBox[{
            RowBox[{"Length", "[", 
             RowBox[{"oSolve", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "\[NotEqual]", " ", 
            RowBox[{"Length", "[", "oOutput", "]"}]}]}], ",", " ", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"underCheck", " ", "=", " ", 
            RowBox[{"TimeConstrained", "[", 
             RowBox[{
              RowBox[{"FindInstance", "[", 
               RowBox[{
                RowBox[{"Join", "[", 
                 RowBox[{"oEquations", ",", "oConstraints"}], "]"}], ",", 
                "oOutput", ",", "Reals", ",", " ", "1"}], "]"}], ",", "60", 
              ",", "$Failed"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"Which", "[", 
            RowBox[{
             RowBox[{"FailureQ", "[", "underCheck", "]"}], ",", 
             RowBox[{
             "Print", "[", 
              "\"\<Invalid system: distribution either underspecified or \
conflicting\>\"", "]"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"Length", "[", "underCheck", "]"}], " ", "\[Equal]", 
              " ", "1"}], ",", 
             RowBox[{
             "Print", "[", 
              "\"\<Underspecified system: needs more valid \
specifications\>\"", "]"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]",
              "True", ",", 
             RowBox[{
             "Print", "[", 
              "\"\<Invalid system: some specifications not consistent\>\"", 
              "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
           "\[IndentingNewLine]", "$Failed"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"oRules", " ", "=", " ", 
            RowBox[{"oSolve", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"oFinalRules", " ", "=", " ", 
            RowBox[{"oRules", "//.", 
             RowBox[{
              RowBox[{"{", "x_", "}"}], "\[RuleDelayed]", "x"}]}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"oD", " ", "=", " ", 
            RowBox[{"CategoricalDistribution", "[", 
             RowBox[{"values", ",", " ", 
              RowBox[{"oParams", " ", "/.", " ", "oFinalRules"}]}], "]"}]}], 
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"Information", "[", 
            RowBox[{"oD", ",", " ", "\"\<ProbabilityTable\>\""}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"RandomVariate", "[", 
            RowBox[{"oD", ",", " ", "numsamples"}], "]"}]}]}], 
         "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{
        "Print", "[", "\"\<Invalid system: solver timed out\>\"", "]"}]}], 
       "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.80616687230968*^9, 3.806166873252181*^9}, {
   3.806166906203412*^9, 3.806166914551113*^9}, {3.806167013996767*^9, 
   3.806167022915382*^9}, {3.8061698585602713`*^9, 3.806169863159781*^9}, {
   3.806184087628173*^9, 3.806184104383193*^9}, {3.806232395305496*^9, 
   3.806232407925177*^9}, {3.806232438291535*^9, 3.806232478022849*^9}, {
   3.806338497916649*^9, 3.806338521031192*^9}, {3.806338570596449*^9, 
   3.8063385997103863`*^9}, {3.806339067280827*^9, 3.806339074641738*^9}, {
   3.8063396766426*^9, 3.806339693174127*^9}, {3.806340237069634*^9, 
   3.8063402417556963`*^9}, {3.806340429531657*^9, 3.806340449548078*^9}, {
   3.806340732524172*^9, 3.806340741987574*^9}, {3.806429142871931*^9, 
   3.8064292140511475`*^9}, {3.80642926781135*^9, 3.806429272216619*^9}, 
   3.806429436943007*^9, 3.806429516099732*^9, {3.8064295498513064`*^9, 
   3.806429629262438*^9}, {3.806429673790893*^9, 3.80642970392975*^9}, {
   3.806429737280301*^9, 3.806429737959501*^9}, {3.8064297848387675`*^9, 
   3.8064298288290586`*^9}, {3.8064299877978797`*^9, 3.8064299923687*^9}, {
   3.8064301244754925`*^9, 3.8064301439132214`*^9}, 3.8064303185904713`*^9, {
   3.8064313652239823`*^9, 
   3.806431375566052*^9}},ExpressionUUID->"7a35983a-2079-45ed-b03e-\
16c052fc27f1"]
},
WindowSize->{1142.7, 581.6999999999999},
WindowMargins->{{0, Automatic}, {Automatic, 0}},
FrontEndVersion->"12.1 for Microsoft Windows (64-bit) (March 18, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"7fd964e2-56ce-4396-9485-f3abe5275eda"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 10550, 229, 1004, "Input",ExpressionUUID->"7a35983a-2079-45ed-b03e-16c052fc27f1"]
}
]
*)

